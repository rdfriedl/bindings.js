!function(ctx){function duplicateObject(n,e){if("object"==typeof n&&null!==n){if(e=void 0!==e?e:20,e>0)if(n.hasOwnProperty("length"))for(var i=[],t=0;t<n.length;t++)i[t]="object"!=typeof n[t]?n[t]:duplicateObject(n[t],e-1);else{var i={};for(var t in n)i[t]="object"!=typeof n[t]?n[t]:duplicateObject(n[t],e-1)}return i}return n}bindings={bindings:{},createModal:function(n,e){var i=new this.Modal(n,e);return n._binding=i,n},applyBindings:function(n,e){n=n||{},n instanceof this.Modal?n.applyBindings(e):n._binding instanceof this.Modal&&n._binding.applyBindings(e)},_applyBindings:function(n,e){if(!(e instanceof bindings.Scope||e instanceof bindings.Value))throw new Error("second argument has to be a Scope or a Value");for(var i=[],t=0;t<n.children.length;t++){var s=this._parseBindings(n.children[t],e);i=i.concat(s),n.children[t].children&&(i=i.concat(this._applyBindings(n.children[t],n.children[t].__scope__||e)))}return i},_parseBindings:function(n,e){if(!(n instanceof Node))throw new Error("first argument has to be a Node");if(!(e instanceof bindings.Scope||e instanceof bindings.Value))throw new Error("second argument has to be a Scope or a Value");for(var i=[],t=n.attributes||[],s=0;s<t.length;s++){var o=t.item(s),r=o.name;if(-1!==r.search("bind-")){r=r.substr(r.indexOf("-")+1,r.length);var a=o.value,c=new bindings.Binding(n,a,e,r);i.push(c)}}return i},_eval:function(string,scope){if(!(scope instanceof bindings.Scope||scope instanceof bindings.Value))throw new Error("second argument has to be a Scope or a Value");string=string||"";var data={value:void 0,success:!0},func="new Function(",args=[],context=scope.value;func+='"return ',func+=string,func+='")',func=eval(func);try{data.value=func.apply(context,args)}catch(e){data.success=!1}return data},_evalRequires:function(string,scope){if(!(scope instanceof bindings.Scope||scope instanceof bindings.Value))throw new Error("second argument has to be a Scope or a Value");string=string||"";var data={success:!0,requires:[],sets:[],gets:[]},scopeVars={console:{},window:{},navigator:{},localStorage:{},location:{},alert:bindings.noop,eval:bindings.noop},buildContextFromScope=function(n){var e=new n.values.__proto__.constructor;for(var i in n.values)n.values[i]instanceof bindings.Scope?e[i]=buildContextFromScope(n.values[i]):(e.__defineGetter__(i,function(n,e,i){i.requires.push(this.values[e]),i.gets.push(this.values[e])}.bind(n,e,i,data)),e.__defineSetter__(i,function(n,e,i){i.requires.push(this.values[e]),i.sets.push(this.values[e])}.bind(n,e,i,data)));return e},func="new Function(",args=[],context={};for(var i in scopeVars)func+='"'+i+'",',args.push(scopeVars[i]);scope instanceof bindings.Scope?(context=buildContextFromScope(scope),data.gets=[],data.sets=[],data.requires=[]):scope instanceof bindings.Value&&(context=scope.value),func+='"return ',func+=string,func+='")',func=eval(func);try{func.apply(context,args)}catch(e){data.success=!1}for(var d=[],i=0;i<data.requires.length;i++)-1==d.indexOf(data.requires[i])&&d.push(data.requires[i]);return data.requires=d,data},noop:function(){}},bindings.Modal=function(n,e){this.options=Object.create(this.options),this.scope=new bindings.Scope("",n,this),e=e||{};for(var i in e)this.options[i]=e[i];return this},bindings.Modal.prototype={bindings:[],options:{element:document},scope:void 0,applyBindings:function(n){if(!(n instanceof Node))throw new Error("first argument has to be a Node");n&&(this.options.element=n),this.bindings=bindings._applyBindings(this.options.element,this.scope)},getBinding:function(n){if(!(n instanceof Node))throw new Error("first argument has to be a Node");for(var e=0;e<this.bindings.length;e++)if(this.bindings[e].el===n)return this.bindings[e]},removeBinding:function(n){if(!(n instanceof Node))throw new Error("first argument has to be a Node");var e=this.getBinding(n);if(e){e.unbind();for(var i=0;i<this.bindings.length;i++)if(this.bindings[i].el===n)return void delete this.bindings[i]}},removeAllBindings:function(){for(var n=0;n<this.bindings.length;n++)this.bindings[n].unbind();this.bindings=[]}},bindings.Modal.prototype.constructor=bindings.Modal,bindings.Scope=function(n,e,i){return e=e||{},this.key=n||"",this.value=e,this.values=e.hasOwnProperty("length")?[]:{},this.events={},this.parent=i,this.updateKeys(e),Object.observe(this.value,function(n){for(var e=0;e<n.length;e++)if("_binding"!=n[e].name)switch(n[e].type){case"add":this.addKey(n[e].name,n[e].object[n[e].name]);break;case"update":this.updateKey(n[e].name,n[e].object[n[e].name]);break;case"delete":this.removeKey(n[e].name)}}.bind(this)),this},bindings.Scope.prototype={events:{},object:void 0,parent:void 0,values:void 0,addKey:function(n,e){this.values[n]="object"==typeof e?new bindings.Scope(n,e,this):new bindings.Value(n,e,this),this.emit("change",this)},removeKey:function(n){delete this.values[n],this.emit("change",this)},updateKey:function(n,e){this.values[n]||this.addKey(n,e),this.values[n]instanceof bindings.Value?this.values[n].setValue(e):this.values[n]instanceof bindings.Scope&&this.values[n].updateKeys(e),this.emit("change",this)},updateKeys:function(n){n=n||{};for(var e in n)this.updateKey(e,n[e])},getKey:function(n){for(var e in this.values)if(this.values[e].value==n)return this.values[e]},getValue:function(n){return this.values[n]},update:function(){this.emit("change",this)},on:function(n,e,i){this.events[n]||(this.events[n]=[]),i&&(e=e.bind(i)),this.events[n].push(e)},off:function(n,e){this.events[n]||(this.events[n]=[]),-1!==this.events[n].indexOf(e)&&this.events[n].splice(this.events[n].indexOf(e),1)},emit:function(n,e){this.events[n]||(this.events[n]=[]);for(var i=0;i<this.events[n].length;i++)this.events[n][i](e)}},bindings.Scope.prototype.constructor=bindings.Scope,bindings.Value=function(n,e,i){return this.key=n,this.value=e,this.events={},this.parent=i,this},bindings.Value.prototype={value:void 0,parent:void 0,events:{},on:function(n,e,i){this.events[n]||(this.events[n]=[]),i&&(e=e.bind(i)),this.events[n].push(e)},off:function(n,e){this.events[n]||(this.events[n]=[]),-1!==this.events[n].indexOf(e)&&this.events[n].splice(this.events[n].indexOf(e),1)},emit:function(n,e){this.events[n]||(this.events[n]=[]);for(var i=0;i<this.events[n].length;i++)this.events[n][i](e)},setValue:function(n){this.value=n||this.value,this.emit("change",n)},update:function(){this.emit("change",this.value)}},bindings.Value.prototype.constructor=bindings.Value,bindings.Binding=function(n,e,i,t){if(!(i instanceof bindings.Scope||i instanceof bindings.Value))throw new Error("third argument has to be a Scope or a Value");this.el=n,this.scope=i,this.src=new bindings.Src(e,this.scope),this.type=t;var s=bindings.bindings[t];if(s)for(var o in s)this[o]=s[o];else console.error("cant find binding type: "+t);return this._bind(),this._update(),this},bindings.Binding.prototype={el:void 0,scope:void 0,src:void 0,events:[],_bind:function(){this.el.__bindings__=this.el.__bindings__||[],this.el.__bindings__.push(this),this._updateEvents(),this.bind()},_update:function(){try{this.update()}catch(n){console.error("failed to bind"),console.error(this.el),console.error(n)}},_unbind:function(){this.el.__bindings__.splice(this.el.__bindings__.indexOf(this),1);for(var n=0;n<this.src.values.length;n++)this.src.values[n].off("change",this._update.bind(this));this.unbind()},_unbindEvents:function(){for(var n=0;n<this.events.length;n++)this.events[n].obj.off(this.events[n].type,this.events[n].func);this.events=[]},_bindEvents:function(){for(var n=this.src.getRequires(),e=0;e<n.length;e++)this.events.push({type:"change",func:this._update.bind(this),obj:n[e]}),n[e].on("change",this._update.bind(this))},_updateEvents:function(){this._unbindEvents(),this._bindEvents()},bind:function(){},unbind:function(){},update:function(){},getScope:function(){}},bindings.Binding.prototype.constructor=bindings.Binding,bindings.Src=function(n,e){if(!(e instanceof bindings.Scope||e instanceof bindings.Value))throw new Error("second argument has to be a Scope or a Value");return this.string=n||"",this.scope=e,this},bindings.Src.prototype={value:void 0,success:!0,sting:"",scope:void 0,requires:void 0,update:function(){var n=bindings._eval(this.string,this.scope);return this.value=n.value,this.success=n.success,this},getRequires:function(n){return(!this.requires||n)&&(this.requires=bindings._evalRequires(this.string,this.scope).requires),this.requires}},bindings.Src.prototype.constructor=bindings.Src,function(n){n.bindings.text={update:function(){this.src.update(),this.el.textContent=this.src.value}},n.bindings.click={bind:function(){this.event=this.event||function(){this.src.update()}.bind(this)},update:function(){this.el.removeEventListener("click",this.event),this.el.addEventListener("click",this.event)}},n.bindings["with"]={update:function(){this.src.update();for(var n=0;n<this.el.children.length;n++)this.el.children[n].__scope__=this.src.value}},n.bindings.foreach={__foreach_children__:[],bind:function(){for(var n=[],e=0;e<this.el.children.length;e++)n.push(this.el.children[e]);this.__foreach_children__=n},update:function(){for(;0!==this.el.children.length;)this.el.children[0].remove();if(this.src.update(),!(this.src.value instanceof n.Scope))throw new Error("foreach requires a Object or Array");for(var e in this.src.value.values)for(var i=0;i<this.__foreach_children__.length;i++){var t=this.__foreach_children__[i].cloneNode(!0);t.__scope__=this.src.value.values[e],this.el.appendChild(t)}}}}(bindings),ctx.bindings=bindings}(window);