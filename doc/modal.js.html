<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Bindings.js Source: modal.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.dark.css">

	<link type="text/css" rel="stylesheet" href="styles/site.superhero.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top ">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">Bindings.js</a>
	</div>
	<div class="navbar-collapse">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="namespaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="bindings.html">bindings</a></li><li><a href="bindings.utils.html">bindings.utils</a></li><li><a href="bindingTypes.html">bindingTypes</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="bindings.Binding.html">bindings.Binding</a></li><li><a href="bindings.EventBinding.html">bindings.EventBinding</a></li><li><a href="bindings.EventEmiter.html">bindings.EventEmiter</a></li><li><a href="bindings.Expression.html">bindings.Expression</a></li><li><a href="bindings.InlineBinding.html">bindings.InlineBinding</a></li><li><a href="bindings.Modal.html">bindings.Modal</a></li><li><a href="bindings.OneWayBinding.html">bindings.OneWayBinding</a></li><li><a href="bindings.Scope.html">bindings.Scope</a></li><li><a href="bindings.TwoWayBinding.html">bindings.TwoWayBinding</a></li><li><a href="bindings.Value.html">bindings.Value</a></li><li><a href="bindingTypes.AttrBinding.html">bindingTypes.AttrBinding</a></li><li><a href="bindingTypes.ClassBinding.html">bindingTypes.ClassBinding</a></li><li><a href="bindingTypes.ClickBinding.html">bindingTypes.ClickBinding</a></li><li><a href="bindingTypes.DisabledBinding.html">bindingTypes.DisabledBinding</a></li><li><a href="bindingTypes.EnabledBinding.html">bindingTypes.EnabledBinding</a></li><li><a href="bindingTypes.EventBinding.html">bindingTypes.EventBinding</a></li><li><a href="bindingTypes.ForEachBinding.html">bindingTypes.ForEachBinding</a></li><li><a href="bindingTypes.HiddenBinding.html">bindingTypes.HiddenBinding</a></li><li><a href="bindingTypes.HrefBinding.html">bindingTypes.HrefBinding</a></li><li><a href="bindingTypes.HTMLBinding.html">bindingTypes.HTMLBinding</a></li><li><a href="bindingTypes.IfBinding.html">bindingTypes.IfBinding</a></li><li><a href="bindingTypes.IfNotBinding.html">bindingTypes.IfNotBinding</a></li><li><a href="bindingTypes.InputBinding.html">bindingTypes.InputBinding</a></li><li><a href="bindingTypes.SrcBinding.html">bindingTypes.SrcBinding</a></li><li><a href="bindingTypes.StyleBinding.html">bindingTypes.StyleBinding</a></li><li><a href="bindingTypes.SubmitBinding.html">bindingTypes.SubmitBinding</a></li><li><a href="bindingTypes.TextBinding.html">bindingTypes.TextBinding</a></li><li><a href="bindingTypes.ValueBinding.html">bindingTypes.ValueBinding</a></li><li><a href="bindingTypes.VisibleBinding.html">bindingTypes.VisibleBinding</a></li><li><a href="bindingTypes.WithBinding.html">bindingTypes.WithBinding</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="tutorials.list.html" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="tutorial-bind-attr.html">bind-attr</a></li><li><a href="tutorial-bind-class.html">bind-class</a></li><li><a href="tutorial-bind-disabled.html">bind-disabled</a></li><li><a href="tutorial-bind-text.html">bind-text</a></li><li><a href="tutorial-getting started.html">getting started</a></li><li><a href="tutorial-inline bindings.html">inline bindings</a></li>
				</ul>
			</li>
			
		</ul>
	</div>
</div>
</div>


<div class="container">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
    		<h1 class="page-title">Source: modal.js</h1>
			

		<h1 class="page-title">Source: modal.js</h1>
    
<section>
	<article>
		<pre
			class="sunlight-highlight-javascript linenums">/// &lt;reference path="bindings.ts" />
var bindings;
(function (bindings) {
    var Modal = (function () {
        /**
        @constructs bindings.Modal
        @arg {Object} object
        @arg {Object} options
        @arg {string} [options.prefix=bind] - the prefix to use when binding
        @arg {Node} node
        */
        function Modal(object, options, node) {
            if (typeof options === "undefined") { options = {}; }
            if (typeof node === "undefined") { node = document.body; }
            this.object = object;
            this.node = node;
            /**
            an array of bindings for this modal
            @member
            @type {bindings.Binding[]}
            */
            this.bindings = [];
            /**
            @property {Object} options - options for this modal
            @property {Object} options.prefix=bind - the prefix this modal will use
            */
            this.options = {
                prefix: 'bind',
                inlineDelimiters: ['{', '}'],
                excludedElements: {
                    script: true,
                    link: true,
                    meta: true,
                    style: true
                }
            };
            this.scope = new bindings.Scope('', object, this);
            for (var i in options) {
                this.options[i] = options[i];
            }
        }
        /**
        @arg {Node} node - the node to bind to
        */
        Modal.prototype.applyBindings = function (node) {
            if (typeof node === "undefined") { node = undefined; }
            //remove old event
            this.node.removeEventListener('DOMNodeInserted', this.ElementChange.bind(this));
            this.node.removeEventListener('DOMNodeRemoved', this.ElementChange.bind(this));

            if (node)
                this.node = node;

            this.bindings = this.buildBindings();

            this.node.addEventListener('DOMNodeInserted', this.ElementChange.bind(this));
            this.node.addEventListener('DOMNodeRemoved', this.ElementChange.bind(this));
        };

        /**
        loop through this.nodes children and create the bindings
        @private
        @arg {Node} [node=this.node]
        @arg {bindings.Scope} [scope=this.scope]
        @returns {bindings.Binding[]}
        */
        Modal.prototype.buildBindings = function (node, scope) {
            if (typeof node === "undefined") { node = this.node; }
            if (typeof scope === "undefined") { scope = node.__scope__ || this.scope; }
            var bindingsCreated = [];

            if (node.nodeName.toLowerCase() in this.options.excludedElements)
                return;

            //remove old bindings
            if (node.__bindings__) {
                for (var i = 0; i &lt; node.__bindings__.length; i++) {
                    node.__bindings__[i].unbind();
                }
                ;
                node.__bindings__ = [];
            }

            //set scope
            node.__scope__ = node.__scope__ || scope;
            if (node.parentNode) {
                node.__addedScope__ = bindings.extendNew(node.parentNode.__addedScope__ || {}, node.__addedScope__ || {});
            }

            bindingsCreated = bindingsCreated.concat(this.createBindings(node)); //createBindings handles setting __bindings__

            for (var i = 0; i &lt; node.childNodes.length; i++) {
                var childNode = node.childNodes[i];

                if (childNode.nodeName.toLowerCase() in this.options.excludedElements)
                    continue;

                bindingsCreated = bindingsCreated.concat(this.buildBindings(childNode, childNode.__scope__ || scope));
            }
            ;

            return bindingsCreated;
        };

        /** @private */
        Modal.prototype.createBindings = function (node) {
            var bindingsCreated = [];
            switch (node.nodeType) {
                case node.ELEMENT_NODE:
                    bindingsCreated = this.createAttrBindings(node);
                    break;
                case node.TEXT_NODE:
                    bindingsCreated = this.createInlineBindings(node);
                    break;
            }
            return bindingsCreated;
        };

        /** @private */
        Modal.prototype.createAttrBindings = function (node) {
            var bindingsCreated = [];
            var attrs = node.attributes;
            var types = [];

            for (var i = 0; i &lt; attrs.length; i++) {
                var attr = attrs.item(i);
                var _types = attr.name.split('-');

                if (_types[0] == this.options.prefix) {
                    _types.splice(0, 1); //remove the prefix
                    var fn = bindingTypes.getBinding(_types[0]);
                    if (fn) {
                        types.push({
                            types: _types,
                            attr: attr,
                            constructor: fn
                        });
                    } else {
                        console.error('cant find binding: ' + attr.name);
                    }
                }
            }
            ;

            //sort by priority
            types.sort(function (a, b) {
                if (a.constructor.priority &lt; b.constructor.priority) {
                    return 1;
                } else if (a.constructor.priority > b.constructor.priority) {
                    return -1;
                } else {
                    return 0;
                }
            });

            for (var i = 0; i &lt; types.length; i++) {
                var t = types[i];

                try  {
                    bindingsCreated.push(bindingTypes.createBinding(t.types, node, t.attr.value));
                } catch (e) {
                    console.error('failed to create binding: ' + t.attr.name);
                    console.error(e);
                }
            }

            node.__bindings__ = bindingsCreated;
            return bindingsCreated;
        };

        /** @private */
        Modal.prototype.createInlineBindings = function (node) {
            var bindingsCreated = [];
            var tokens = this.parseInlineBindings(node.nodeValue, this.options.inlineDelimiters);

            if (!(tokens.length === 1 &amp;&amp; tokens[0].type === 'text')) {
                for (var i = 0; i &lt; tokens.length; i++) {
                    var token = tokens[i];
                    var textNode = document.createTextNode(token.value);

                    //copy scopes
                    // textNode.__bindings__ = bindings.clone(node.__bindings__); dont clone the bindings array because no two nodes should have the same bindigns
                    textNode.__bindings__ = [];
                    textNode.__scope__ = node.__scope__;
                    textNode.__addedScope__ = bindings.clone(node.__addedScope__);

                    node.parentNode.insertBefore(textNode, node);
                    if (token.type === 'binding') {
                        var b = new bindings.InlineBinding(textNode);
                        textNode.__bindings__ = [b];
                        bindingsCreated.push(b);
                    }
                }
                node.parentNode.removeChild(node);
            }
            return bindingsCreated;
        };

        /** @private */
        Modal.prototype.parseInlineBindings = function (template, delimiters) {
            var index = 0, lastIndex = 0, lastToken, length = template.length, substring, tokens = [], value;
            while (lastIndex &lt; length) {
                index = template.indexOf(delimiters[0], lastIndex);
                if (index &lt; 0) {
                    tokens.push({
                        type: 'text',
                        value: template.slice(lastIndex)
                    });
                    break;
                } else {
                    if (index > 0 &amp;&amp; lastIndex &lt; index) {
                        tokens.push({
                            type: 'text',
                            value: template.slice(lastIndex, index)
                        });
                    }
                    lastIndex = index + delimiters[0].length;
                    index = template.indexOf(delimiters[1], lastIndex);
                    if (index &lt; 0) {
                        substring = template.slice(lastIndex - delimiters[1].length);
                        lastToken = tokens[tokens.length - 1];
                        if ((lastToken != null ? lastToken.type : void 0) === 'text') {
                            lastToken.value += substring;
                        } else {
                            tokens.push({
                                type: 'text',
                                value: substring
                            });
                        }
                        break;
                    }
                    value = template.slice(lastIndex, index).trim();
                    tokens.push({
                        type: 'binding',
                        value: value
                    });
                    lastIndex = index + delimiters[1].length;
                }
            }
            return tokens;
        };

        /** @private */
        Modal.prototype.ElementChange = function (event) {
            event.stopPropagation();

            var el = event.target;
            if (el.nodeType !== 3) {
                this.buildBindings(el);
            }
        };
        return Modal;
    })();
    bindings.Modal = Modal;
})(bindings || (bindings = {}));
</pre>
	</article>
</section>





		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


<footer>


<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.3</a>
	on 2015-11-12T11:53:39-06:00 using the <a
	href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
</span>
</footer>

<!--<script src="scripts/sunlight.js"></script>-->
<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/bootstrap-dropdown.js"></script>
<script src="scripts/toc.js"></script>

<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "h1,h2,h3,h4",
		showAndHide : false,
		scrollTo    : "100px"
	} );

	$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();
	//			$( ".tutorial-section pre, .readme-section pre" ).addClass( "sunlight-highlight-javascript" ).addClass( "linenums" );

	$( ".tutorial-section pre, .readme-section pre" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			lang = "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );
} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->


</body>
</html>
