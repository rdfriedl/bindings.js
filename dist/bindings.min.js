var EventEmiter=function(){function n(){this.events={}}return n.prototype.on=function(n,e,t){void 0===t&&(t=void 0),this.events[n]||(this.events[n]=[]),t&&(e=e.bind(t)),this.events[n].push(e)},n.prototype.off=function(n,e){this.events[n]||(this.events[n]=[]),-1!==this.events[n].indexOf(e)&&this.events[n].splice(this.events[n].indexOf(e),1)},n.prototype.once=function(n,e,t){void 0===t&&(t=void 0),this.on(n,function(n,t){e&&e(),this.off(n,t)}.bind(this),t)},n.prototype.emit=function(n,e){void 0===e&&(e=void 0),this.events[n]||(this.events[n]=[]);for(var t=0;t<this.events[n].length;t++)this.events[n][t](e)},n}(),bindings;!function(n){var e=function(){function e(e,t){this.object=e,this.element=t,this.bindings=[],this.scope=new n.Scope("",e,this)}return e.prototype.applyBindings=function(n){void 0===n&&(n=void 0),this.element.removeEventListener("DOMNodeInserted",this.ElementChange.bind(this)),this.element.removeEventListener("DOMNodeRemoved",this.ElementChange.bind(this)),n&&(this.element=n),this.bindings=this.buildBindings(),this.element.addEventListener("DOMNodeInserted",this.ElementChange.bind(this)),this.element.addEventListener("DOMNodeRemoved",this.ElementChange.bind(this))},e.prototype.buildBindings=function(n,e){void 0===n&&(n=this.element),void 0===e&&(e=n.__scope__||this.scope);var t=[];if(n.__bindings__){for(var i=0;i<n.__bindings__.length;i++)n.__bindings__[i].unbind();n.__bindings__=[]}n.__scope__=e;var s=this.parseBindings(n);if(n.__bindings__=s,t=t.concat(n.__bindings__),n.children)for(var i=0;i<n.children.length;i++){var o=n.children[i];o.__scope__=o.__scope__||e,this.buildBindings(o,o.__scope__),t=t.concat(o.__bindings__)}return t},e.prototype.parseBindings=function(n){for(var e=[],t=n.attributes,i=0;i<t.length;i++){var s=t.item(i),o=s.name;if(0==o.search("bind-")){o=o.substr(o.indexOf("-")+1,o.length);var r=bindingTypes.createBinding(o,n,s);r?e.push(r):console.error("cant find binding: "+o)}}return e},e.prototype.ElementChange=function(n){n.stopPropagation();var e=n.target;3!==e.nodeType&&this.buildBindings(e)},e}();n.Modal=e}(bindings||(bindings={}));var __extends=this.__extends||function(n,e){function t(){this.constructor=n}for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);t.prototype=e.prototype,n.prototype=new t},bindings;!function(n){var e=function(e){function t(n,t,i,s){void 0===s&&(s=void 0),e.call(this),this.key=n,this.object=t,this.modal=i,this.parent=s,this.values=t instanceof Array?[]:{},this.setKeys(this.object),Object.observe(this.object,this.objectChange.bind(this))}return __extends(t,e),t.prototype.getKey=function(n){for(var e in this.values)if(this.values[e].value==n)return e},t.prototype.setKey=function(e,t,i){void 0===i&&(i=!1),void 0==this.values[e]&&(this.values[e]=t instanceof Object?new n.Scope(e,t,this.modal,this):new n.Value(e,t,this)),this.values[e]instanceof n.Value?this.values[e].setValue(t):this.values[e]instanceof n.Scope&&this.values[e].setKeys(t),i||this.update()},t.prototype.setKeys=function(n,e){void 0===e&&(e=!1);for(var t in n)this.setKey(t,n[t],!0);e||this.update()},t.prototype.removeKey=function(n,e){void 0===e&&(e=!1),delete this.values[n],e||this.emit("change",this)},t.prototype.updateKey=function(n,e){this.object[n]=e},t.prototype.updateKeys=function(n){for(var e in n)this.updateKey(e,n[e])},t.prototype.update=function(){this.emit("change",this.object)},t.prototype.objectChange=function(n){for(var e=0;e<n.length;e++)if("_bindings"!=n[e].name)switch(n[e].type){case"add":this.setKey(n[e].name,n[e].object[n[e].name],!0);break;case"update":this.setKey(n[e].name,n[e].object[n[e].name],!0);break;case"delete":this.removeKey(n[e].name,!0)}this.update()},t.prototype.emit=function(t,i,s){switch(void 0===i&&(i=void 0),void 0===s&&(s=""),e.prototype.emit.call(this,t,i),s){case"down":for(var o in this.values)this.values[o]instanceof n.Scope?this.values[o].emit(t,i,s):this.values[o].emit(t,i);break;case"up":this.parent&&this.parent.emit(t,i,s)}},t}(EventEmiter);n.Scope=e}(bindings||(bindings={}));var bindings;!function(n){var e=function(n){function e(e,t,i){n.call(this),this.key="",this.key=e,this.value=t,this.parent=i}return __extends(e,n),e.prototype.setValue=function(n){return this.value=n,this.update(),this.value},e.prototype.updateValue=function(n){this.parent.updateKey(this.key,n)},e.prototype.update=function(){this.emit("change",this.value)},e}(EventEmiter);n.Value=e}(bindings||(bindings={}));var bindings;!function(n){var e=function(){function e(e,t){this.element=e,this.attr=t,this.expression=new n.expression(t,this.scope)}return Object.defineProperty(e.prototype,"scope",{get:function(){return this.element.__scope__},enumerable:!0,configurable:!0}),e.prototype.run=function(){},e.prototype.unbind=function(){},e.id="",e}();n.Binding=e;var t=function(n){function e(e,t){n.call(this,e,t),this.dependencies=[],this.updateDependencies()}return __extends(e,n),e.prototype.dependencyChange=function(){this.run()},e.prototype.run=function(){n.prototype.run.call(this),this.expression.run()},e.prototype.unbind=function(){this.unbindDependencies()},e.prototype.getDependencies=function(n){return void 0===n&&(n=!1),(n||void 0==this.dependencies)&&(this.dependencies=this.expression.getDependencies().requires),this.dependencies},e.prototype.updateDependencies=function(){this.getDependencies(!0),this.unbindDependencies(),this.bindDependencies()},e.prototype.bindDependencies=function(){for(var n=0;n<this.dependencies.length;n++)this.dependencies[n].on("change",this.dependencyChange.bind(this))},e.prototype.unbindDependencies=function(){for(var n=0;n<this.dependencies.length;n++)this.dependencies[n].off("change",this.dependencyChange.bind(this))},e}(n.Binding);n.OneWayBinding=t;var i=function(n){function e(e,t){n.call(this,e,t),this.domEvents=[],this.dontUpdate=!1,this.bindEvents()}return __extends(e,n),e.prototype.change=function(){this.dontUpdate=!0},e.prototype.dependencyChange=function(){this.dontUpdate||n.prototype.dependencyChange.call(this),this.dontUpdate=!1},e.prototype.unbind=function(){n.prototype.unbind.call(this),this.unbindEvents()},e.prototype.updateEvents=function(){this.unbindEvents(),this.bindEvents()},e.prototype.bindEvents=function(){for(var n=0;n<this.domEvents.length;n++)this.element.addEventListener(this.domEvents[n],this.change.bind(this))},e.prototype.unbindEvents=function(){for(var n=0;n<this.domEvents.length;n++)this.element.removeEventListener(this.domEvents[n],this.change.bind(this))},e}(n.OneWayBinding);n.TwoWayBinding=i;var s=function(n){function e(e,t){n.call(this,e,t),this.element=e,this.attr=t,this.domEvents=[],this.bindEvents()}return __extends(e,n),e.prototype.change=function(){this.expression.run()},e.prototype.unbind=function(){n.prototype.unbind.call(this),this.unbindEvents()},e.prototype.updateEvents=function(){this.unbindEvents(),this.bindEvents()},e.prototype.bindEvents=function(){for(var n=0;n<this.domEvents.length;n++)this.element.addEventListener(this.domEvents[n],this.change.bind(this))},e.prototype.unbindEvents=function(){for(var n=0;n<this.domEvents.length;n++)this.element.removeEventListener(this.domEvents[n],this.change.bind(this))},e}(n.Binding);n.EventBinding=s}(bindings||(bindings={}));var bindingTypes;!function(n){function e(n,e,t){var i;for(var s in this)if(this[s].id==n){i=new this[s](e,t);break}return i}n.createBinding=e}(bindingTypes||(bindingTypes={}));var bindings;!function(bindings){var expression=function(){function expression(n,e){this.attr=n,this.scope=e,this.success=!0,this.value=void 0,this.dependencies=[]}return expression.prototype.run=function(){var data={value:void 0,success:!0},addedScope={$modal:this.scope.modal?this.scope.modal.scope.object:void 0,$parent:this.scope.parent?this.scope.parent.object:void 0},funcString='new Function("addedScope","',args=[],context=this.scope.object;args.push(addedScope),funcString+="with(this){",funcString+="with(addedScope){",funcString+="return ",funcString+=this.attr.value,funcString+="}",funcString+="}",funcString+='")';var func=eval(funcString);try{data.value=func.apply(context,args)}catch(e){data.success=!1}return this.value=data.value,this.success=data.success,data},expression.prototype.runOnScope=function(){var n={value:void 0,success:!1},e=this.getDependencies();return n.value=e.gets[e.gets.length-1],n.success=!!n.value,n},expression.prototype.getDependencies=function(){var data={success:!0,requires:[],sets:[],gets:[]},hidden={console:{},window:{},navigator:{},localStorage:{},location:{},alert:bindings.noop,eval:bindings.noop},addedScope={$modal:this.scope.modal?this.buildContextFromScope(this.scope.modal.scope,data):void 0,$parent:this.scope.parent?this.buildContextFromScope(this.scope.parent,data):void 0},funcString='new Function("hidden","addedScope",',args=[],context={};args.push(hidden),args.push(addedScope),context=this.buildContextFromScope(this.scope,data),funcString+='"',funcString+="with(this){",funcString+="with(hidden){",funcString+="with(addedScope){",funcString+="return ",funcString+=this.attr.value,funcString+="}",funcString+="}",funcString+="}",funcString+='")';var func=eval(funcString);try{func.apply(context,args)}catch(e){data.success=!1}return this.dependencies=data.requires,data},expression.prototype.buildContextFromScope=function(n,e){var t=n.object instanceof Array?[]:{};for(var i in n.values)t.__defineGetter__(i,function(n,e,t,i){return-1==t.gets.indexOf(this.values[e])&&(t.requires.push(this.values[e]),t.gets.push(this.values[e])),this.values[e].value instanceof Function?this.values[e]instanceof bindings.Scope?i(this.values[e]):this.values[e].value:void 0}.bind(n,t,i,e,this.buildContextFromScope)),t.__defineSetter__(i,function(n,e,t){t.requires.push(this.values[e]),t.sets.push(this.values[e])}.bind(n,t,i,e,this.buildContextFromScope));return t},expression}();bindings.expression=expression}(bindings||(bindings={}));var bindingTypes;!function(n){var e=function(n){function e(e,t){n.call(this,e,t),this.domEvents=["click"],this.updateEvents()}return __extends(e,n),e.id="click",e}(bindings.EventBinding);n.ClickBinding=e}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(n){var e=function(n){function e(e,t){n.call(this,e,t),this.run()}return __extends(e,n),e.prototype.run=function(){n.prototype.run.call(this),this.expression.value?this.element.removeAttribute("disabled"):this.element.setAttribute("disabled","disabled")},e.id="enabled",e}(bindings.OneWayBinding);n.EnabledBinding=e}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(n){var e=function(n){function e(e,t){n.call(this,e,t),this.run()}return __extends(e,n),e.prototype.run=function(){n.prototype.run.call(this),this.expression.value?this.element.setAttribute("disabled","disabled"):this.element.removeAttribute("disabled")},e.id="disabled",e}(bindings.OneWayBinding);n.DisabledBinding=e}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(n){var e=function(n){function e(e,t){n.call(this,e,t),this.children=[];for(var i=0;i<this.element.children.length;i++)this.children.push(this.element.children[i]);this.removeAllChildren(),this.run()}return __extends(e,n),e.prototype.restoreChildren=function(){for(var n in this.children)this.element.appendChild(this.children[n])},e.prototype.removeAllChildren=function(){for(;0!==this.element.children.length;)this.element.removeChild(this.element.children[0])},e.prototype.run=function(){var n=this.expression.runOnScope().value;if(this.removeAllChildren(),!(n instanceof bindings.Scope))throw new Error("bind-foreach requires a Object or Array");for(var e in n.values)for(var t=0;t<this.children.length;t++){var i=this.children[t].cloneNode(!0);i.__scope__=n.values[e],this.element.appendChild(i)}},e.prototype.unbind=function(){this.removeAllChildren(),n.prototype.unbind.call(this),this.restoreChildren()},e.id="foreach",e}(bindings.OneWayBinding);n.ForEachBinding=e}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(n){var e=function(n){function e(e,t){n.call(this,e,t),this.children=[];for(var i=0;i<this.element.children.length;i++)this.children.push(this.element.children[i]);this.run()}return __extends(e,n),e.prototype.restoreChildren=function(){for(var n in this.children)this.element.appendChild(this.children[n])},e.prototype.removeChildren=function(){for(;0!==this.element.children.length;)this.element.removeChild(this.element.children[0])},e.prototype.run=function(){n.prototype.run.call(this),this.expression.value?this.restoreChildren():this.removeChildren()},e.prototype.unbind=function(){n.prototype.unbind.call(this),this.removeChildren(),this.restoreChildren()},e.id="if",e}(bindings.OneWayBinding);n.IfBinding=e}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(n){var e=function(n){function e(e,t){n.call(this,e,t),this.children=[];for(var i=0;i<this.element.children.length;i++)this.children.push(this.element.children[i]);this.run()}return __extends(e,n),e.prototype.restoreChildren=function(){for(var n in this.children)this.element.appendChild(this.children[n])},e.prototype.removeChildren=function(){for(;0!==this.element.children.length;)this.element.removeChild(this.element.children[0])},e.prototype.run=function(){n.prototype.run.call(this),this.expression.value?this.removeChildren():this.restoreChildren()},e.prototype.unbind=function(){n.prototype.unbind.call(this),this.removeChildren(),this.restoreChildren()},e.id="ifnot",e}(bindings.OneWayBinding);n.IfNotBinding=e}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(n){var e=function(n){function e(e,t){n.call(this,e,t),this.domEvents=["keypress","keyup"],this.updateEvents()}return __extends(e,n),e.prototype.change=function(){if("createEvent"in document){var n=document.createEvent("HTMLEvents");n.initEvent("change",!1,!0),this.element.dispatchEvent(n)}},e.id="live-update",e}(bindings.EventBinding);n.LiveUpdateBinding=e}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(n){var e=function(n){function e(e,t){n.call(this,e,t),this.children=[];for(var i=0;i<this.element.children.length;i++)this.children.push(this.element.children[i]);this.removeChildren(),this.run()}return __extends(e,n),e.prototype.restoreChildren=function(){for(var n in this.children)this.element.appendChild(this.children[n])},e.prototype.removeChildren=function(){for(;0!==this.element.children.length;)this.element.removeChild(this.element.children[0])},e.prototype.run=function(){n.prototype.run.call(this),this.removeChildren();for(var e=0;e<this.expression.value;e++)for(var t=0;t<this.children.length;t++){var i=this.children[t].cloneNode(!0);this.element.appendChild(i)}},e.prototype.unbind=function(){this.removeChildren(),n.prototype.unbind.call(this),this.restoreChildren()},e.id="repeat",e}(bindings.OneWayBinding);n.RepeatBinding=e}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(n){var e=function(n){function e(e,t){n.call(this,e,t),this.domEvents=["submit"],this.updateEvents()}return __extends(e,n),e.prototype.change=function(e){n.prototype.change.call(this,e),e.preventDefault()},e.id="submit",e}(bindings.EventBinding);n.SubmitBinding=e}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(n){var e=function(n){function e(e,t){n.call(this,e,t),this.oldText=this.element.textContent,this.run()}return __extends(e,n),e.prototype.run=function(){n.prototype.run.call(this),this.element.innerText=this.expression.value},e.prototype.unbind=function(){n.prototype.unbind.call(this),this.element.textContent=this.oldText},e.id="text",e}(bindings.OneWayBinding);n.TextBinding=e}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(n){var e=function(n){function e(e,t){n.call(this,e,t),this.element=e,this.domEvents=["change"],this.updateEvents()}return __extends(e,n),e.prototype.run=function(){this.element.value=this.expression.value},e.prototype.change=function(e){n.prototype.change.call(this,e);var t=this.expression.runOnScope().value;t instanceof bindings.Value&&t.updateValue(this.element.value)},e.id="value",e}(bindings.TwoWayBinding);n.ValueBinding=e}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(n){var e=function(n){function e(e,t){n.call(this,e,t),this.run()}return __extends(e,n),e.prototype.run=function(){var n=this.expression.runOnScope().value;if(!(n instanceof bindings.Scope))throw new Error("bind-with requires a Object or Array");for(var e=0;e<this.element.children.length;e++){var t=this.element.children[e];t.__scope__=n}},e.id="with",e}(bindings.OneWayBinding);n.WithBinding=e}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(n){var e=function(n){function e(e,t){n.call(this,e,t),this.run()}return __extends(e,n),e.prototype.run=function(){n.prototype.run.call(this),this.element.style.display=this.expression.value?"":"none"},e.id="visible",e}(bindings.OneWayBinding);n.VisibleBinding=e}(bindingTypes||(bindingTypes={}));var bindings;!function(n){function e(e,t){void 0===e&&(e={}),void 0===t&&(t=document),t instanceof Document&&(t=t.body);var i=new n.Modal(e,t);return e._bindings=i,e}function t(e,t){void 0===e&&(e={}),void 0===t&&(t=document),t instanceof Document&&(t=t.body),e instanceof n.Modal?e.applyBindings(t):e._bindings instanceof n.Modal&&e._bindings.applyBindings(t)}function i(n,e){if(void 0===e&&(e=20),n instanceof Object&&null!==n){if(e>0)if(n.hasOwnProperty("length"))for(var t=new Array(0),i=0;i<n.length;i++)t[i]="object"!=typeof n[i]?n[i]:this.duplicateObject(n[i],e-1);else{var t;for(var s in n)t[s]=n[s]instanceof Object?this.duplicateObject(n[s],e-1):n[s]}return t}return n}function s(){}n.createModal=e,n.applyBindings=t,n.duplicateObject=i,n.noop=s}(bindings||(bindings={}));