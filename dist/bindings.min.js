var EventEmiter=function(){function a(){this.events={}}return a.prototype.on=function(a,b,c){void 0===c&&(c=void 0),this.events[a]||(this.events[a]=[]),c&&(b=b.bind(c)),this.events[a].push(b)},a.prototype.off=function(a,b){this.events[a]||(this.events[a]=[]),-1!==this.events[a].indexOf(b)&&this.events[a].splice(this.events[a].indexOf(b),1)},a.prototype.once=function(a,b,c){void 0===c&&(c=void 0),this.on(a,function(a,c){b&&b(),this.off(a,c)}.bind(this),c)},a.prototype.emit=function(a,b){void 0===b&&(b=void 0),this.events[a]||(this.events[a]=[]);for(var c=0;c<this.events[a].length;c++)this.events[a][c](b)},a}(),bindings;!function(a){var b=function(){function b(b,c){this.object=b,this.element=c,this.bindings=[],this.scope=new a.Scope("",b,this)}return b.prototype.applyBindings=function(a){void 0===a&&(a=void 0),this.element.removeEventListener("DOMNodeInserted",this.ElementChange.bind(this)),this.element.removeEventListener("DOMNodeRemoved",this.ElementChange.bind(this)),a&&(this.element=a),this.bindings=this.buildBindings(),this.element.addEventListener("DOMNodeInserted",this.ElementChange.bind(this)),this.element.addEventListener("DOMNodeRemoved",this.ElementChange.bind(this))},b.prototype.buildBindings=function(a,b){void 0===a&&(a=this.element),void 0===b&&(b=a.__scope__||this.scope);var c=[];if(a.__bindings__){for(var d=0;d<a.__bindings__.length;d++)a.__bindings__[d].unbind();a.__bindings__=[]}a.__scope__=b,a.__addedScope__=a.__addedScope__||{};var e=this.parseBindings(a);if(a.__bindings__=e,c=c.concat(a.__bindings__),a.children)for(var d=0;d<a.children.length;d++){var f=a.children[d];f.__scope__=f.__scope__||b,f.__addedScope__=f.__addedScope__||a.__addedScope__,this.buildBindings(f,f.__scope__),c=c.concat(f.__bindings__)}return c},b.prototype.parseBindings=function(a){for(var b=[],c=a.attributes,d=0;d<c.length;d++){var e=c.item(d),f=e.name;if(0==f.search("bind-")){f=f.substr(f.indexOf("-")+1,f.length);var g=bindingTypes.createBinding(f,a,e);g?b.push(g):console.error("cant find binding: "+f)}}return b},b.prototype.ElementChange=function(a){a.stopPropagation();var b=a.target;3!==b.nodeType&&this.buildBindings(b)},b}();a.Modal=b}(bindings||(bindings={}));var __extends=this.__extends||function(a,b){function d(){this.constructor=a}for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d},bindings;!function(a){var b=function(b){function c(a,c,d,e){void 0===e&&(e=void 0),b.call(this),this.key=a,this.object=c,this.modal=d,this.parent=e,this.values=c instanceof Array?[]:{},this.setKeys(this.object),Object.observe(this.object,this.objectChange.bind(this))}return __extends(c,b),c.prototype.getKey=function(a){for(var b in this.values)if(this.values[b].value==a)return b},c.prototype.setKey=function(b,c,d){void 0===d&&(d=!1),void 0==this.values[b]&&(this.values[b]="object"==typeof c?new a.Scope(b,c,this.modal,this):new a.Value(b,c,this)),this.values[b]instanceof a.Value?this.values[b].setValue(c):this.values[b]instanceof a.Scope&&this.values[b].setKeys(c),d||this.update()},c.prototype.setKeys=function(a,b){void 0===b&&(b=!1);for(var c in a)this.setKey(c,a[c],!0);b||this.update()},c.prototype.removeKey=function(a,b){void 0===b&&(b=!1),delete this.values[a],b||this.emit("change",this)},c.prototype.updateKey=function(a,b){this.object[a]=b},c.prototype.updateKeys=function(a){for(var b in a)this.updateKey(b,a[b])},c.prototype.update=function(){this.emit("change",this.object)},c.prototype.objectChange=function(a){for(var b=0;b<a.length;b++)if("_bindings"!=a[b].name)switch(a[b].type){case"add":this.setKey(a[b].name,a[b].object[a[b].name],!0);break;case"update":this.setKey(a[b].name,a[b].object[a[b].name],!0);break;case"delete":this.removeKey(a[b].name,!0)}this.update()},c.prototype.emit=function(c,d,e){switch(void 0===d&&(d=void 0),void 0===e&&(e=""),b.prototype.emit.call(this,c,d),e){case"down":for(var f in this.values)this.values[f]instanceof a.Scope?this.values[f].emit(c,d,e):this.values[f].emit(c,d);break;case"up":this.parent&&this.parent.emit(c,d,e)}},c}(EventEmiter);a.Scope=b}(bindings||(bindings={}));var bindings;!function(a){var b=function(a){function b(b,c,d){a.call(this),this.key="",this.key=b,this.value=c,this.parent=d}return __extends(b,a),b.prototype.setValue=function(a){return this.value=a,this.update(),this.value},b.prototype.updateValue=function(a){this.parent.updateKey(this.key,a)},b.prototype.update=function(){this.emit("change",this.value)},b}(EventEmiter);a.Value=b}(bindings||(bindings={}));var bindings;!function(a){var b=function(){function b(b,c){this.element=b,this.attr=c,this.expression=new a.Expression(b,c,this.scope)}return Object.defineProperty(b.prototype,"scope",{get:function(){return this.element.__scope__},enumerable:!0,configurable:!0}),b.prototype.run=function(){},b.prototype.unbind=function(){},b.id="",b}();a.Binding=b;var c=function(a){function b(b,c){a.call(this,b,c),this.dependencies=[],this.updateDependencies()}return __extends(b,a),b.prototype.dependencyChange=function(){this.run()},b.prototype.run=function(){a.prototype.run.call(this),this.expression.run()},b.prototype.unbind=function(){this.unbindDependencies()},b.prototype.getDependencies=function(a){return void 0===a&&(a=!1),(a||void 0==this.dependencies)&&(this.dependencies=this.expression.getDependencies().requires),this.dependencies},b.prototype.updateDependencies=function(){this.getDependencies(!0),this.unbindDependencies(),this.bindDependencies()},b.prototype.bindDependencies=function(){for(var a=0;a<this.dependencies.length;a++)this.dependencies[a].on("change",this.dependencyChange.bind(this))},b.prototype.unbindDependencies=function(){for(var a=0;a<this.dependencies.length;a++)this.dependencies[a].off("change",this.dependencyChange.bind(this))},b}(a.Binding);a.OneWayBinding=c;var d=function(a){function b(b,c){a.call(this,b,c),this.domEvents=[],this.dontUpdate=!1,this.bindEvents()}return __extends(b,a),b.prototype.change=function(){this.dontUpdate=!0},b.prototype.dependencyChange=function(){this.dontUpdate||a.prototype.dependencyChange.call(this),this.dontUpdate=!1},b.prototype.unbind=function(){a.prototype.unbind.call(this),this.unbindEvents()},b.prototype.updateEvents=function(){this.unbindEvents(),this.bindEvents()},b.prototype.bindEvents=function(){for(var a=0;a<this.domEvents.length;a++)this.element.addEventListener(this.domEvents[a],this.change.bind(this))},b.prototype.unbindEvents=function(){for(var a=0;a<this.domEvents.length;a++)this.element.removeEventListener(this.domEvents[a],this.change.bind(this))},b}(a.OneWayBinding);a.TwoWayBinding=d;var e=function(a){function b(b,c){a.call(this,b,c),this.element=b,this.attr=c,this.domEvents=[],this.bindEvents()}return __extends(b,a),b.prototype.change=function(){this.expression.run()},b.prototype.unbind=function(){a.prototype.unbind.call(this),this.unbindEvents()},b.prototype.updateEvents=function(){this.unbindEvents(),this.bindEvents()},b.prototype.bindEvents=function(){for(var a=0;a<this.domEvents.length;a++)this.element.addEventListener(this.domEvents[a],this.change.bind(this))},b.prototype.unbindEvents=function(){for(var a=0;a<this.domEvents.length;a++)this.element.removeEventListener(this.domEvents[a],this.change.bind(this))},b}(a.Binding);a.EventBinding=e}(bindings||(bindings={}));var bindingTypes;!function(a){function b(a,b,c){var d;for(var e in this)if(this[e].id==a){d=new this[e](b,c);break}return d}a.createBinding=b}(bindingTypes||(bindingTypes={}));var bindings;!function(bindings){var Expression=function(){function Expression(a,b,c){this.element=a,this.attr=b,this.scope=c,this.success=!0,this.value=void 0,this.dependencies=[]}return Expression.prototype.run=function(){var data={value:void 0,success:!0},variables={$modal:this.scope.modal?this.scope.modal.scope.object:void 0},funcString='new Function("variables","addedScope","',args=[],context=this.buildContext(this.scope).context;args.push(variables),args.push(this.element.__addedScope__||{}),funcString+="with(this){",funcString+="with(variables){",funcString+="with(addedScope){",funcString+="return ",funcString+=this.attr.value,funcString+="}",funcString+="}",funcString+="}",funcString+='")';var func=eval(funcString);try{data.value=func.apply(context,args)}catch(e){data.success=!1}return this.value=data.value,this.success=data.success,data},Expression.prototype.runOnScope=function(){var a={value:void 0,success:!1},b=this.getDependencies();return a.value=b.gets[b.gets.length-1],a.success=!!a.value,a},Expression.prototype.getDependencies=function(){var data={success:!0,requires:[],gets:[],sets:[]},hidden={console:{},window:{},navigator:{},localStorage:{},location:{},alert:bindings.noop,eval:bindings.noop},variables={$modal:this.scope.modal?this.buildContext(this.scope.modal.scope,data):void 0},funcString='new Function("hidden","variables","addedScope",',args=[];args.push(hidden),args.push(variables),args.push(this.element.__addedScope__||{});var context=this.buildContext(this.scope,data,!0);funcString+='"',funcString+="with(this){",funcString+="with(hidden){",funcString+="with(variables){",funcString+="with(addedScope){",funcString+="return ",funcString+=this.attr.value,funcString+="}",funcString+="}",funcString+="}",funcString+="}",funcString+='")';var func=eval(funcString);try{func.apply(context.context,args)}catch(e){data.success=!1}return this.dependencies=data.requires,data},Expression.prototype.buildContext=function(a,b,c){void 0===b&&(b={requires:[],gets:[],sets:[]}),void 0===c&&(c=!1);var d=a.object instanceof Array?[]:{},e=function(a,b,d,e){return-1==e.gets.indexOf(a.values[d])&&(e.requires.push(a.values[d]),e.gets.push(a.values[d])),a.values[d]instanceof bindings.Scope?this.buildContext(a.values[d],e,c).context:a.values[d]instanceof bindings.Value&&!(a.values[d].value instanceof Function&&c)?a.values[d].value:void 0},f=function(a,b,d,e,f){e.requires.push(a.values[d]),e.sets.push(a.values[d]),c||(a.object[d]=f)};for(var g in a.values)d.__defineGetter__(g,e.bind(this,a,d,g,b)),d.__defineSetter__(g,f.bind(this,a,d,g,b));return a.parent&&d.__defineGetter__("$parent",function(a,b,c,d){return a.parent?(-1==c.gets.indexOf(a.parent)&&(c.requires.push(a.parent),c.gets.push(a.parent)),this.buildContext(a.parent,c,d).context):void 0}.bind(this,a,d,b,c)),a.modal&&d.__defineGetter__("$modal",function(a,b,c,d){return a.modal?(-1==c.gets.indexOf(a.modal.scope)&&(c.requires.push(a.modal.scope),c.gets.push(a.modal.scope)),this.buildContext(a.modal.scope,c,d).context):void 0}.bind(this,a,d,b,c)),{context:d,requires:b}},Expression}();bindings.Expression=Expression}(bindings||(bindings={}));var bindingTypes;!function(a){var b=function(a){function b(b,c){a.call(this,b,c),this.domEvents=["click"],this.updateEvents()}return __extends(b,a),b.id="click",b}(bindings.EventBinding);a.ClickBinding=b}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(a){var b=function(a){function b(b,c){a.call(this,b,c),this.run()}return __extends(b,a),b.prototype.run=function(){a.prototype.run.call(this),this.expression.value?this.element.removeAttribute("disabled"):this.element.setAttribute("disabled","disabled")},b.id="enabled",b}(bindings.OneWayBinding);a.EnabledBinding=b}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(a){var b=function(a){function b(b,c){a.call(this,b,c),this.run()}return __extends(b,a),b.prototype.run=function(){a.prototype.run.call(this),this.expression.value?this.element.setAttribute("disabled","disabled"):this.element.removeAttribute("disabled")},b.id="disabled",b}(bindings.OneWayBinding);a.DisabledBinding=b}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(a){var b=function(a){function b(b,c){a.call(this,b,c),this.children=[];for(var d=0;d<this.element.children.length;d++)this.children.push(this.element.children[d]);this.removeAllChildren(),this.run()}return __extends(b,a),b.prototype.restoreChildren=function(){for(var a in this.children)this.element.appendChild(this.children[a])},b.prototype.removeAllChildren=function(){for(;0!==this.element.children.length;)this.element.removeChild(this.element.children[0])},b.prototype.run=function(){var a=this.expression.runOnScope().value;if(this.removeAllChildren(),!(a instanceof bindings.Scope))throw new Error("bind-foreach requires a Object or Array");for(var b in a.values)for(var c=0;c<this.children.length;c++){var d=this.children[c].cloneNode(!0);d.__scope__=a.values[b],d.__addedScope__={$index:b,$isFirst:0==b,$isLast:b==a.values.length-1},this.element.appendChild(d)}},b.prototype.unbind=function(){this.removeAllChildren(),a.prototype.unbind.call(this),this.restoreChildren()},b.id="foreach",b}(bindings.OneWayBinding);a.ForEachBinding=b}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(a){var b=function(a){function b(b,c){a.call(this,b,c),this.children=[];for(var d=0;d<this.element.children.length;d++)this.children.push(this.element.children[d]);this.run()}return __extends(b,a),b.prototype.restoreChildren=function(){for(var a in this.children)this.element.appendChild(this.children[a])},b.prototype.removeChildren=function(){for(;0!==this.element.children.length;)this.element.removeChild(this.element.children[0])},b.prototype.run=function(){a.prototype.run.call(this),this.expression.value?this.restoreChildren():this.removeChildren()},b.prototype.unbind=function(){a.prototype.unbind.call(this),this.removeChildren(),this.restoreChildren()},b.id="if",b}(bindings.OneWayBinding);a.IfBinding=b}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(a){var b=function(a){function b(b,c){a.call(this,b,c),this.children=[];for(var d=0;d<this.element.children.length;d++)this.children.push(this.element.children[d]);this.run()}return __extends(b,a),b.prototype.restoreChildren=function(){for(var a in this.children)this.element.appendChild(this.children[a])},b.prototype.removeChildren=function(){for(;0!==this.element.children.length;)this.element.removeChild(this.element.children[0])},b.prototype.run=function(){a.prototype.run.call(this),this.expression.value?this.removeChildren():this.restoreChildren()},b.prototype.unbind=function(){a.prototype.unbind.call(this),this.removeChildren(),this.restoreChildren()},b.id="ifnot",b}(bindings.OneWayBinding);a.IfNotBinding=b}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(a){var b=function(a){function b(b,c){a.call(this,b,c),this.domEvents=["input"],this.updateEvents()}return __extends(b,a),b.prototype.change=function(){if("createEvent"in document){var b=document.createEvent("HTMLEvents");b.initEvent("change",!1,!0),this.element.dispatchEvent(b)}},b.id="live-update",b}(bindings.EventBinding);a.LiveUpdateBinding=b}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(a){var b=function(a){function b(b,c){a.call(this,b,c),this.children=[];for(var d=0;d<this.element.children.length;d++)this.children.push(this.element.children[d]);this.removeChildren(),this.run()}return __extends(b,a),b.prototype.restoreChildren=function(){for(var a in this.children)this.element.appendChild(this.children[a])},b.prototype.removeChildren=function(){for(;0!==this.element.children.length;)this.element.removeChild(this.element.children[0])},b.prototype.run=function(){a.prototype.run.call(this),this.removeChildren();for(var b=this.expression.value,c=0;b>c;c++)for(var d=0;d<this.children.length;d++){var e=this.children[d].cloneNode(!0);e.__addedScope__={$index:c,$isFirst:0==c,$isLast:c==b-1},this.element.appendChild(e)}},b.prototype.unbind=function(){this.removeChildren(),a.prototype.unbind.call(this),this.restoreChildren()},b.id="repeat",b}(bindings.OneWayBinding);a.RepeatBinding=b}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(a){var b=function(a){function b(b,c){a.call(this,b,c),this.domEvents=["submit"],this.updateEvents()}return __extends(b,a),b.prototype.change=function(b){a.prototype.change.call(this,b),b.preventDefault()},b.id="submit",b}(bindings.EventBinding);a.SubmitBinding=b}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(a){var b=function(a){function b(b,c){a.call(this,b,c),this.oldText=this.element.textContent,this.run()}return __extends(b,a),b.prototype.run=function(){a.prototype.run.call(this),this.element.innerText=this.expression.value},b.prototype.unbind=function(){a.prototype.unbind.call(this),this.element.textContent=this.oldText},b.id="text",b}(bindings.OneWayBinding);a.TextBinding=b}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(a){var b=function(a){function b(b,c){a.call(this,b,c),this.element=b,this.domEvents=["change"],this.updateEvents()}return __extends(b,a),b.prototype.run=function(){a.prototype.run.call(this),this.element.value=this.expression.value},b.prototype.change=function(b){a.prototype.change.call(this,b);var c=this.expression.runOnScope().value;c instanceof bindings.Value&&c.updateValue(this.element.value)},b.id="value",b}(bindings.TwoWayBinding);a.ValueBinding=b}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(a){var b=function(a){function b(b,c){a.call(this,b,c),this.run()}return __extends(b,a),b.prototype.run=function(){var a=this.expression.runOnScope().value;if(!(a instanceof bindings.Scope))throw new Error("bind-with requires a Object or Array");for(var b=0;b<this.element.children.length;b++){var c=this.element.children[b];c.__scope__=a}},b.id="with",b}(bindings.OneWayBinding);a.WithBinding=b}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(a){var b=function(a){function b(b,c){a.call(this,b,c),this.oldText=this.element.textContent,this.run()}return __extends(b,a),b.prototype.run=function(){a.prototype.run.call(this),this.element.innerHTML=this.expression.value},b.prototype.unbind=function(){a.prototype.unbind.call(this),this.element.textContent=this.oldText},b.id="html",b}(bindings.OneWayBinding);a.HTMLBinding=b}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(a){var b=function(a){function b(b,c){a.call(this,b,c),this.run()}return __extends(b,a),b.prototype.run=function(){a.prototype.run.call(this),this.element.style.display=this.expression.value?"":"none"},b.id="visible",b}(bindings.OneWayBinding);a.VisibleBinding=b}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(a){var b=function(a){function b(b,c){a.call(this,b,c),this.run()}return __extends(b,a),b.prototype.run=function(){a.prototype.run.call(this),this.element.setAttribute("href",this.expression.value)},b.id="href",b}(bindings.OneWayBinding);a.HrefBinding=b}(bindingTypes||(bindingTypes={}));var bindingTypes;!function(a){var b=function(a){function b(b,c){a.call(this,b,c),this.run()}return __extends(b,a),b.prototype.run=function(){a.prototype.run.call(this),this.element.setAttribute("src",this.expression.value)},b.id="src",b}(bindings.OneWayBinding);a.SrcBinding=b}(bindingTypes||(bindingTypes={}));var bindings;!function(a){function b(b,c){void 0===b&&(b={}),void 0===c&&(c=document),c instanceof Document&&(c=c.body);var d=new a.Modal(b,c);return b._bindings=d,b}function c(b,c){void 0===b&&(b={}),void 0===c&&(c=document),c instanceof Document&&(c=c.body),b instanceof a.Modal?b.applyBindings(c):b._bindings instanceof a.Modal&&b._bindings.applyBindings(c)}function d(a,b){if(void 0===b&&(b=20),a instanceof Object&&null!==a){if(b>0)if(a.hasOwnProperty("length"))for(var c=new Array(0),d=0;d<a.length;d++)c[d]="object"!=typeof a[d]?a[d]:this.duplicateObject(a[d],b-1);else{var c;for(var e in a)c[e]=a[e]instanceof Object?this.duplicateObject(a[e],b-1):a[e]}return c}return a}function e(){}a.createModal=b,a.applyBindings=c,a.duplicateObject=d,a.noop=e}(bindings||(bindings={}));