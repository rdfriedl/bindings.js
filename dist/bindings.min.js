!function(){bindings={bindings:{},createModal:function(e,i){var n=new this.Modal(e,i);return e._binding=n,e},applyBindings:function(e,i){e=e||{},e instanceof this.Modal?e.applyBindings(i):e._binding instanceof this.Modal&&e._binding.applyBindings(i)},_applyBindings:function(e,i){if(!(e instanceof Node))throw new Error("first argument has to be a Node");if(!(i instanceof bindings.Scope||i instanceof bindings.Value))throw new Error("second argument has to be a Scope or a Value");var n=[];if(e.__bindings__){for(var t=e.__bindings__.length-1;t>=0;t--)e.__bindings__[t]._unbind();e.__bindings__=[]}var s=bindings._parseBindings(e,i);if(e.__bindings__=s,n=n.concat(e.__bindings__),e.children)for(var t=0;t<e.children.length;t++)e.children[t].__scope__=e.children[t].__scope__||i,bindings._applyBindings(e.children[t],e.children[t].__scope__),n=n.concat(e.children[t].__bindings__);return n},_parseBindings:function(e,i){if(!(e instanceof Node))throw new Error("first argument has to be a Node");if(!(i instanceof bindings.Scope||i instanceof bindings.Value))throw new Error("second argument has to be a Scope or a Value");for(var n=[],t=e.attributes||[],s=0;s<t.length;s++){var r=t.item(s),o=r.name;if(-1!==o.search("bind-")){o=o.substr(o.indexOf("-")+1,o.length);var h=r.value,d=new bindings.Binding(e,h,i,o);n.push(d)}}return n},_modalChange:function(e,i){for(var n=0;n<i.length;n++)if("_binding"!=i[n].name)switch(i[n].type){case"add":e.setKey(i[n].name,i[n].object[i[n].name],!0);break;case"update":e.setKey(i[n].name,i[n].object[i[n].name],!0);break;case"delete":e.removeKey(i[n].name,!0)}e.update()},_nodeChange:function(e){e.stopPropagation();var i=e.target.__scope__||e.relatedNode.__scope__;i&&bindings._applyBindings(e.target,i)},_eval:function(string,scope){if(!(scope instanceof bindings.Scope||scope instanceof bindings.Value))throw new Error("second argument has to be a Scope or a Value");string=string||"";var data={value:void 0,success:!0},func='new Function("',args=[],context=scope.value;func+="with(this){",func+="return ",func+=string,func+="}",func+='")',func=eval(func);try{data.value=func.apply(context,args)}catch(e){data.success=!1}return data},_evalRequires:function(string,scope){if(!(scope instanceof bindings.Scope||scope instanceof bindings.Value))throw new Error("second argument has to be a Scope or a Value");string=string||"";var data={success:!0,requires:[],sets:[],gets:[]},scopeVars={console:{},window:{},navigator:{},localStorage:{},location:{},alert:bindings.noop,eval:bindings.noop},buildContextFromScope=function(e){var i=new e.values.__proto__.constructor;for(var n in e.values)i.__defineGetter__(n,function(e,i,n){return n.requires.push(this.values[i]),n.gets.push(this.values[i]),"function"!=typeof this.values[i].value?this.values[i]instanceof bindings.Scope?buildContextFromScope(this.values[i]):this.values[i].value:void 0}.bind(e,i,n,data)),i.__defineSetter__(n,function(e,i,n){n.requires.push(this.values[i]),n.sets.push(this.values[i])}.bind(e,i,n,data));return i},func="new Function(",args=[],context={};for(var i in scopeVars)func+='"'+i+'",',args.push(scopeVars[i]);scope instanceof bindings.Scope?(context=buildContextFromScope(scope),data.gets=[],data.sets=[],data.requires=[]):scope instanceof bindings.Value&&(context=scope.value),func+='"with(this){',func+="return ",func+=string,func+="}",func+='")',func=eval(func);try{func.apply(context,args)}catch(e){data.success=!1}for(var d=[],i=0;i<data.requires.length;i++)-1==d.indexOf(data.requires[i])&&d.push(data.requires[i]);return data.requires=d,data},_evalOnScope:function(){var e={value:void 0,success:!1},i=bindings._evalRequires.apply(this,arguments);return e.value=i.gets[i.gets.length-1],e.success=!!e.value,e},_duplicateObject:function(e,i){if("object"==typeof e&&null!==e){if(i=void 0!==i?i:20,i>0)if(e.hasOwnProperty("length"))for(var n=[],t=0;t<e.length;t++)n[t]="object"!=typeof e[t]?e[t]:bindings._duplicateObject(e[t],i-1);else{var n={};for(var t in e)n[t]="object"!=typeof e[t]?e[t]:bindings._duplicateObject(e[t],i-1)}return n}return e},noop:function(){}},bindings.Modal=function(e,i){this.options=Object.create(this.options),this.scope=new bindings.Scope("",e),i=i||{};for(var n in i)this.options[n]=i[n];return this},bindings.Modal.prototype={bindings:[],options:{element:document},scope:void 0,applyBindings:function(e){if(!(e instanceof Node)&&e)throw new Error("first argument has to be a Node");e&&(this.options.element=e),this.removeAllBindings(),this.bindings=bindings._applyBindings(this.options.element,this.scope),this.options.element.removeEventListener("DOMNodeInserted",bindings._nodeChange),this.options.element.addEventListener("DOMNodeInserted",bindings._nodeChange),this.options.element.removeEventListener("DOMNodeRemoved",bindings._nodeChange),this.options.element.addEventListener("DOMNodeRemoved",bindings._nodeChange)},getBinding:function(e){if(!(e instanceof Node))throw new Error("first argument has to be a Node");for(var i=0;i<this.bindings.length;i++)if(this.bindings[i].el===e)return this.bindings[i]},removeBinding:function(e){if(!(e instanceof Node))throw new Error("first argument has to be a Node");var i=this.getBinding(e);if(i){i._unbind();for(var n=0;n<this.bindings.length;n++)if(this.bindings[n].el===e)return void delete this.bindings[n]}},removeAllBindings:function(){for(var e=0;e<this.bindings.length;e++)this.bindings[e]._unbind();this.bindings=[]}},bindings.Modal.prototype.constructor=bindings.Modal,bindings.Scope=function(e,i,n){return i=i||{},this.key=e||"",this.value=i,this.values=i.hasOwnProperty("length")?[]:{},this.events={},this.parent=n,this.setKeys(i),Object.observe(this.value,bindings._modalChange.bind(this,this)),this},bindings.Scope.prototype={events:{},object:void 0,parent:void 0,values:void 0,getKey:function(e){for(var i in this.values)if(this.values[i].value==e)return i},setKey:function(e,i,n){void 0==this.values[e]&&(this.values[e]="object"==typeof i?new bindings.Scope(e,i,this):new bindings.Value(e,i,this)),this.values[e]instanceof bindings.Value?this.values[e].setValue(i):this.values[e]instanceof bindings.Scope&&this.values[e].setKeys(i),n||this.emit("change",this)},setKeys:function(e,i){e=e||{};for(var n in e)this.setKey(n,e[n],!0);i||this.emit("change",this)},removeKey:function(e,i){delete this.values[e],i||this.emit("change",this)},updateKey:function(e,i){this.value[e]=i},updateKeys:function(e){for(var i in e)this.updateKey(i,e[i])},update:function(){this.emit("change",this)},on:function(e,i,n){this.events[e]||(this.events[e]=[]),n&&(i=i.bind(n)),this.events[e].push(i)},off:function(e,i){this.events[e]||(this.events[e]=[]),-1!==this.events[e].indexOf(i)&&this.events[e].splice(this.events[e].indexOf(i),1)},emit:function(e,i,n){this.events[e]||(this.events[e]=[]);for(var t=0;t<this.events[e].length;t++)this.events[e][t](i);switch(n){case"up":this.parent&&this.parent.emit(e,void 0,n);break;case"down":for(var t in this.values)this.values[t].emit(e,void 0,n)}}},bindings.Scope.prototype.constructor=bindings.Scope,bindings.Value=function(e,i,n){return this.key=e,this.value=i,this.events={},this.parent=n,this},bindings.Value.prototype={key:"",value:void 0,parent:void 0,events:{},on:function(e,i,n){this.events[e]||(this.events[e]=[]),n&&(i=i.bind(n)),this.events[e].push(i)},off:function(e,i){this.events[e]||(this.events[e]=[]),-1!==this.events[e].indexOf(i)&&this.events[e].splice(this.events[e].indexOf(i),1)},emit:function(e,i,n){this.events[e]||(this.events[e]=[]);for(var t=0;t<this.events[e].length;t++)this.events[e][t](i);switch(n){case"up":this.parent&&this.parent.emit(e,void 0,n);break;case"down":}},setValue:function(e,i){this.value=void 0!==e?e:this.value,i||this.emit("change",e)},updateValue:function(e){this.parent.updateKey(this.key,e)},update:function(){this.emit("change",this.value)}},bindings.Value.prototype.constructor=bindings.Value,bindings.Binding=function(e,i,n,t){if(!(n instanceof bindings.Scope||n instanceof bindings.Value))throw new Error("third argument has to be a Scope or a Value");this.el=e,this.scope=n,this.src=new bindings.Script(i,this.scope),this.type=t;var s=bindings.bindings[t];if(s)for(var r in s)this[r]=s[r];else console.error("cant find binding type: "+t);return this._bind(),this._update(),this},bindings.Binding.prototype={el:void 0,scope:void 0,src:void 0,events:[],_bind:function(){this._updateEvents(),this.bind()},_update:function(){try{this.update()}catch(e){console.error('failed to bind: "'+this.src.string+'" on element'),console.error(this.el),console.error(e)}},_unbind:function(){this._unbindEvents(),this.unbind()},_unbindEvents:function(){for(var e=0;e<this.events.length;e++)this.events[e].obj.off(this.events[e].type,this.events[e].func);this.events=[]},_bindEvents:function(){for(var e=this.src.getRequires(),i=0;i<e.length;i++)this.events.push({type:"change",func:this._update.bind(this),obj:e[i]}),e[i].on("change",this._update.bind(this))},_updateEvents:function(){this._unbindEvents(),this._bindEvents()},bind:function(){},unbind:function(){},update:function(){},getScope:function(){}},bindings.Binding.prototype.constructor=bindings.Binding,bindings.Script=function(e,i){if(!(i instanceof bindings.Scope||i instanceof bindings.Value))throw new Error("second argument has to be a Scope or a Value");return this.string=e||"",this.scope=i,this},bindings.Script.prototype={value:void 0,success:!0,string:"",scope:void 0,requires:void 0,eval:bindings._eval,update:function(){var e=this.eval(this.string,this.scope);return this.value=e.value,this.success=e.success,this},getRequires:function(e){return(!this.requires||e)&&(this.requires=bindings._evalRequires(this.string,this.scope).requires),this.requires},setEval:function(e){try{var i=e("this",this.scope);if(void 0===i)throw new Error("function dose not return a object");if(!i.hasOwnProperty("value")&&!i.hasOwnProperty("success"))throw new Error("function dose not return a object or returned object is missing values");this.eval=e}catch(n){console.error("invalid eval function"),console.error(n)}}},bindings.Script.prototype.constructor=bindings.Script,document.children||document.__defineGetter__("children",function(){return this.body.children}),bindings.bindings.text={update:function(){this.src.update(),this.el.innerText=this.src.value}},bindings.bindings.html={update:function(){this.src.update(),this.el.innerHTML=this.src.value}},bindings.bindings.href={update:function(){this.src.update(),this.el.setAttribute("href",this.src.value)}},bindings.bindings.src={update:function(){this.src.update(),this.el.setAttribute("src",this.src.value)}},bindings.bindings.display={update:function(){this.src.update(),this.src.value?this.el.style.removeProperty("display","none"):this.el.style.setProperty("display","none")}},bindings.bindings.visible={update:function(){this.src.update(),this.src.value?this.el.style.setProperty("visibility","visible"):this.el.style.setProperty("visibility","hidden")}},bindings.bindings.enabled={update:function(){this.src.update(),this.src.value?this.el.removeAttribute("disabled"):this.el.setAttribute("disabled","disabled")}},bindings.bindings.disabled={update:function(){this.src.update(),this.src.value?this.el.setAttribute("disabled","disabled"):this.el.removeAttribute("disabled")}},bindings.bindings["if"]={children:[],restoreChildren:function(){if(!this.children.length)for(var e=0;e<this.children.length;e++)this.el.appendChild(this.children[e])},removeChildren:function(){if(this.children.length)for(;0!==this.el.children.length;)this.el.removeChild(this.el.children[0])},bind:function(){for(var e=0;e<this.el.children.length;e++)this.children.push(this.el.children[e])},update:function(){this.src.update(),this.src.value?this.restoreChildren():this.removeChildren()}},bindings.bindings.ifnot={children:[],restoreChildren:function(){if(!this.children.length)for(var e=0;e<this.children.length;e++)this.el.appendChild(this.children[e])},removeChildren:function(){if(this.children.length)for(;0!==this.el.children.length;)this.el.removeChild(this.el.children[0])},bind:function(){for(var e=0;e<this.el.children.length;e++)this.children.push(this.el.children[e])},update:function(){this.src.update(),this.src.value?this.removeChildren():this.restoreChildren()}},bindings.bindings.click={_event:void 0,bind:function(){this._event=function(){this.src.update()}.bind(this),this.el.addEventListener("click",this._event)},unbind:function(){this.el.removeEventListener("click",this._event)}},bindings.bindings.dblclick={_event:void 0,bind:function(){this._event=function(){this.src.update()}.bind(this),this.el.addEventListener("dblclick",this._event)},unbind:function(){this.el.removeEventListener("dblclick",this._event)}},bindings.bindings.submit={_event:void 0,bind:function(){this._event=this.submit.bind(this),this.el.addEventListener("submit",this._event)},submit:function(e){e.preventDefault(),this.src.update()},unbind:function(){this.el.removeEventListener("submit",this._event)}},bindings.bindings.value={_event:void 0,_dontUpdate:!1,bind:function(){this._event=this.change.bind(this),this.el.addEventListener("change",this._event),this.src.setEval(bindings._evalOnScope)},change:function(){if(this.src.update(),!(this.src.value instanceof bindings.Value))throw new Error("bind-value requires a instance of bindings.Value");this._dontUpdate=!0,this.src.value.updateValue(this.el.value)},update:function(){this._dontUpdate?this._dontUpdate=!1:(this.src.update(),this.el.value=this.src.value.value)},unbind:function(){this.el.removeEventListener("change",this._event)}},bindings.bindings["live-update"]={event:function(){if("createEvent"in document){var e=document.createEvent("HTMLEvents");e.initEvent("change",!1,!0),this.el.dispatchEvent(e)}},bind:function(){this.el.addEventListener("keypress",this.event.bind(this)),this.el.addEventListener("keyup",this.event.bind(this))},unbind:function(){this.el.removeEventListener("keypress",this.event.bind(this)),this.el.removeEventListener("keyup",this.event.bind(this))}},bindings.bindings["with"]={bind:function(){this.src.setEval(bindings._evalOnScope)},update:function(){if(this.src.update(),!(this.src.value instanceof bindings.Scope))throw new Error("with requires a Object or Array");for(var e=0;e<this.el.children.length;e++)this.el.children[e].__scope__=this.src.value}},bindings.bindings.foreach={__foreach_children__:[],removeAllChildren:function(){for(;0!==this.el.children.length;)this.el.removeChild(this.el.children[0])},bind:function(){this.src.setEval(bindings._evalOnScope);for(var e=[],i=0;i<this.el.children.length;i++)e.push(this.el.children[i]);this.__foreach_children__=e},update:function(){if(this.removeAllChildren(),this.src.update(),!(this.src.value instanceof bindings.Scope))throw new Error("foreach requires a Object or Array");for(var e in this.src.value.values)for(var i=0;i<this.__foreach_children__.length;i++){var n=this.__foreach_children__[i].cloneNode(!0);n.__scope__=this.src.value.values[e],this.el.appendChild(n)}},unbind:function(){this.removeAllChildren();for(var e=0;e<this.__foreach_children__.length;e++){var i=this.__foreach_children__[e].cloneNode(!0);this.el.appendChild(i)}}},bindings.bindings.repeat={__foreach_children__:[],removeAllChildren:function(){for(;0!==this.el.children.length;)this.el.removeChild(this.el.children[0])},bind:function(){for(var e=[],i=0;i<this.el.children.length;i++)e.push(this.el.children[i]);this.__foreach_children__=e},update:function(){this.removeAllChildren(),this.src.update();for(var e=0;e<this.src.value;e++)for(var i=0;i<this.__foreach_children__.length;i++){var n=this.__foreach_children__[i].cloneNode(!0);this.el.appendChild(n)}},unbind:function(){this.removeAllChildren();for(var e=0;e<this.__foreach_children__.length;e++){var i=this.__foreach_children__[e].cloneNode(!0);this.el.appendChild(i)}}}}();