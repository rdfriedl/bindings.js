!function(ctx){function duplicateObject(e,n){if("object"==typeof e&&null!==e){if(n=void 0!==n?n:20,n>0)if(e.hasOwnProperty("length"))for(var i=[],t=0;t<e.length;t++)i[t]="object"!=typeof e[t]?e[t]:duplicateObject(e[t],n-1);else{var i={};for(var t in e)i[t]="object"!=typeof e[t]?e[t]:duplicateObject(e[t],n-1)}return i}return e}bindings={bindings:{},createModal:function(e,n){var i=new this.Modal(e,n);return e._binding=i,e},applyBindings:function(e,n){e=e||{},e instanceof this.Modal?e.applyBindings(n):e._binding instanceof this.Modal&&e._binding.applyBindings(n)},_applyBindings:function(e,n){if(!(e instanceof Node))throw new Error("first argument has to be a Node");if(!(n instanceof bindings.Scope||n instanceof bindings.Value))throw new Error("second argument has to be a Scope or a Value");var i=[];if(e.__bindings__){for(var t=e.__bindings__.length-1;t>=0;t--)e.__bindings__[t]._unbind();e.__bindings__=[]}var s=bindings._parseBindings(e,n);if(e.__bindings__=s,i=i.concat(e.__bindings__),e.children)for(var t=0;t<e.children.length;t++)e.children[t].__scope__=e.children[t].__scope__||n,bindings._applyBindings(e.children[t],e.children[t].__scope__),i=i.concat(e.children[t].__bindings__);return i},_parseBindings:function(e,n){if(!(e instanceof Node))throw new Error("first argument has to be a Node");if(!(n instanceof bindings.Scope||n instanceof bindings.Value))throw new Error("second argument has to be a Scope or a Value");for(var i=[],t=e.attributes||[],s=0;s<t.length;s++){var o=t.item(s),r=o.name;if(-1!==r.search("bind-")){r=r.substr(r.indexOf("-")+1,r.length);var a=o.value,c=new bindings.Binding(e,a,n,r);i.push(c)}}return i},_modalChange:function(e,n){for(var i=0;i<n.length;i++)if("_binding"!=n[i].name)switch(n[i].type){case"add":e.setKey(n[i].name,n[i].object[n[i].name],!0);break;case"update":e.setKey(n[i].name,n[i].object[n[i].name],!0);break;case"delete":e.removeKey(n[i].name,!0)}e.update()},_nodeChange:function(e){e.stopPropagation();var n=e.target.__scope__||e.relatedNode.__scope__;n&&bindings._applyBindings(e.target,n)},_eval:function(string,scope){if(!(scope instanceof bindings.Scope||scope instanceof bindings.Value))throw new Error("second argument has to be a Scope or a Value");string=string||"";var data={value:void 0,success:!0},func="new Function(",args=[],context=scope.value;func+='"return ',func+=string,func+='")',func=eval(func);try{data.value=func.apply(context,args)}catch(e){data.success=!1}return data},_evalRequires:function(string,scope){if(!(scope instanceof bindings.Scope||scope instanceof bindings.Value))throw new Error("second argument has to be a Scope or a Value");string=string||"";var data={success:!0,requires:[],sets:[],gets:[]},scopeVars={console:{},window:{},navigator:{},localStorage:{},location:{},alert:bindings.noop,eval:bindings.noop},buildContextFromScope=function(e){var n=new e.values.__proto__.constructor;for(var i in e.values)n.__defineGetter__(i,function(e,n,i){return i.requires.push(this.values[n]),i.gets.push(this.values[n]),"function"!=typeof this.values[n].value?this.values[n]instanceof bindings.Scope?buildContextFromScope(this.values[n]):this.values[n].value:void 0}.bind(e,n,i,data)),n.__defineSetter__(i,function(e,n,i){i.requires.push(this.values[n]),i.sets.push(this.values[n])}.bind(e,n,i,data));return n},func="new Function(",args=[],context={};for(var i in scopeVars)func+='"'+i+'",',args.push(scopeVars[i]);scope instanceof bindings.Scope?(context=buildContextFromScope(scope),data.gets=[],data.sets=[],data.requires=[]):scope instanceof bindings.Value&&(context=scope.value),func+='"return ',func+=string,func+='")',func=eval(func);try{func.apply(context,args)}catch(e){data.success=!1}for(var d=[],i=0;i<data.requires.length;i++)-1==d.indexOf(data.requires[i])&&d.push(data.requires[i]);return data.requires=d,data},_evalOnScope:function(){var e={value:void 0,success:!1},n=bindings._evalRequires.apply(this,arguments);return e.value=n.gets[n.gets.length-1],e.success=!!e.value,e},noop:function(){}},bindings.Modal=function(e,n){this.options=Object.create(this.options),this.scope=new bindings.Scope("",e),n=n||{};for(var i in n)this.options[i]=n[i];return this},bindings.Modal.prototype={bindings:[],options:{element:document},scope:void 0,applyBindings:function(e){if(!(e instanceof Node)&&e)throw new Error("first argument has to be a Node");e&&(this.options.element=e),this.removeAllBindings(),this.bindings=bindings._applyBindings(this.options.element,this.scope),this.options.element.removeEventListener("DOMNodeInserted",bindings._nodeChange),this.options.element.addEventListener("DOMNodeInserted",bindings._nodeChange),this.options.element.removeEventListener("DOMNodeRemoved",bindings._nodeChange),this.options.element.addEventListener("DOMNodeRemoved",bindings._nodeChange)},getBinding:function(e){if(!(e instanceof Node))throw new Error("first argument has to be a Node");for(var n=0;n<this.bindings.length;n++)if(this.bindings[n].el===e)return this.bindings[n]},removeBinding:function(e){if(!(e instanceof Node))throw new Error("first argument has to be a Node");var n=this.getBinding(e);if(n){n._unbind();for(var i=0;i<this.bindings.length;i++)if(this.bindings[i].el===e)return void delete this.bindings[i]}},removeAllBindings:function(){for(var e=0;e<this.bindings.length;e++)this.bindings[e]._unbind();this.bindings=[]}},bindings.Modal.prototype.constructor=bindings.Modal,bindings.Scope=function(e,n,i){return n=n||{},this.key=e||"",this.value=n,this.values=n.hasOwnProperty("length")?[]:{},this.events={},this.parent=i,this.setKeys(n),Object.observe(this.value,bindings._modalChange.bind(this,this)),this},bindings.Scope.prototype={events:{},object:void 0,parent:void 0,values:void 0,getKey:function(e){for(var n in this.values)if(this.values[n].value==e)return n},setKey:function(e,n,i){void 0==this.values[e]&&(this.values[e]="object"==typeof n?new bindings.Scope(e,n,this):new bindings.Value(e,n,this)),this.values[e]instanceof bindings.Value?this.values[e].setValue(n):this.values[e]instanceof bindings.Scope&&this.values[e].setKeys(n),i||this.emit("change",this)},setKeys:function(e,n){e=e||{};for(var i in e)this.setKey(i,e[i],!0);n||this.emit("change",this)},removeKey:function(e,n){delete this.values[e],n||this.emit("change",this)},updateKey:function(e,n){this.value[e]=n},updateKeys:function(e){for(var n in e)this.updateKey(n,e[n])},getValue:function(e){return this.values[e]},update:function(){this.emit("change",this)},on:function(e,n,i){this.events[e]||(this.events[e]=[]),i&&(n=n.bind(i)),this.events[e].push(n)},off:function(e,n){this.events[e]||(this.events[e]=[]),-1!==this.events[e].indexOf(n)&&this.events[e].splice(this.events[e].indexOf(n),1)},emit:function(e,n,i){this.events[e]||(this.events[e]=[]);for(var t=0;t<this.events[e].length;t++)this.events[e][t](n);switch(i){case"up":this.parent&&this.parent.emit(e,void 0,i);break;case"down":for(var t in this.values)this.values[t].emit(e,void 0,i)}}},bindings.Scope.prototype.constructor=bindings.Scope,bindings.Value=function(e,n,i){return this.key=e,this.value=n,this.events={},this.parent=i,this},bindings.Value.prototype={key:"",value:void 0,parent:void 0,events:{},on:function(e,n,i){this.events[e]||(this.events[e]=[]),i&&(n=n.bind(i)),this.events[e].push(n)},off:function(e,n){this.events[e]||(this.events[e]=[]),-1!==this.events[e].indexOf(n)&&this.events[e].splice(this.events[e].indexOf(n),1)},emit:function(e,n,i){this.events[e]||(this.events[e]=[]);for(var t=0;t<this.events[e].length;t++)this.events[e][t](n);switch(i){case"up":this.parent&&this.parent.emit(e,void 0,i);break;case"down":}},setValue:function(e){this.value=void 0!==e?e:this.value,this.emit("change",e)},updateValue:function(e){this.parent.updateKey(this.key,e)},update:function(){this.emit("change",this.value)}},bindings.Value.prototype.constructor=bindings.Value,bindings.Binding=function(e,n,i,t){if(!(i instanceof bindings.Scope||i instanceof bindings.Value))throw new Error("third argument has to be a Scope or a Value");this.el=e,this.scope=i,this.src=new bindings.Src(n,this.scope),this.type=t;var s=bindings.bindings[t];if(s)for(var o in s)this[o]=s[o];else console.error("cant find binding type: "+t);return this._bind(),this._update(),this},bindings.Binding.prototype={el:void 0,scope:void 0,src:void 0,events:[],_bind:function(){this._updateEvents(),this.bind()},_update:function(){try{this.update()}catch(e){console.error("failed to bind: { "+this.src.string+" } on element"),console.error(this.el),console.error(e)}},_unbind:function(){this._unbindEvents(),this.unbind()},_unbindEvents:function(){for(var e=0;e<this.events.length;e++)this.events[e].obj.off(this.events[e].type,this.events[e].func);this.events=[]},_bindEvents:function(){for(var e=this.src.getRequires(),n=0;n<e.length;n++)this.events.push({type:"change",func:this._update.bind(this),obj:e[n]}),e[n].on("change",this._update.bind(this))},_updateEvents:function(){this._unbindEvents(),this._bindEvents()},bind:function(){},unbind:function(){},update:function(){},getScope:function(){}},bindings.Binding.prototype.constructor=bindings.Binding,bindings.Src=function(e,n){if(!(n instanceof bindings.Scope||n instanceof bindings.Value))throw new Error("second argument has to be a Scope or a Value");return this.string=e||"",this.scope=n,this},bindings.Src.prototype={value:void 0,success:!0,string:"",scope:void 0,requires:void 0,eval:bindings._eval,update:function(){var e=this.eval(this.string,this.scope);return this.value=e.value,this.success=e.success,this},getRequires:function(e){return(!this.requires||e)&&(this.requires=bindings._evalRequires(this.string,this.scope).requires),this.requires},setEval:function(e){try{var n=e("this",this.scope);if(void 0===n)throw new Error("function dose not return a object");if(!n.hasOwnProperty("value")&&!n.hasOwnProperty("success"))throw new Error("function dose not return a object or returned object is missing values");this.eval=e}catch(i){console.error("invalid eval function"),console.error(i)}}},bindings.Src.prototype.constructor=bindings.Src,document.children||document.__defineGetter__("children",function(){return this.body.children}),function(e){e.bindings.text={update:function(){this.src.update(),this.el.textContent=this.src.value}},e.bindings.click={_event:void 0,bind:function(){this._event=function(){this.src.update()}.bind(this),this.el.addEventListener("click",this._event)},unbind:function(){this.el.removeEventListener("click",this._event)}},e.bindings.submit={_event:void 0,bind:function(){this._event=this.submit.bind(this),this.el.addEventListener("submit",this._event)},submit:function(e){e.preventDefault(),this.src.update()},unbind:function(){this.el.removeEventListener("submit",this._event)}},e.bindings.value={_event:void 0,_dontUpdate:!1,bind:function(){this._event=this.change.bind(this),this.el.addEventListener("change",this._event),this.src.setEval(e._evalOnScope)},change:function(){if(this.src.update(),!(this.src.value instanceof e.Value))throw new Error("bind-value requires a instance of bindings.Value");this._dontUpdate=!0,this.src.value.updateValue(this.el.value)},update:function(){this._dontUpdate?this._dontUpdate=!1:(this.src.update(),this.el.value=this.src.value.value)},unbind:function(){this.el.removeEventListener("change",this._event)}},e.bindings["with"]={bind:function(){this.src.setEval(e._evalOnScope)},update:function(){if(this.src.update(),!(this.src.value instanceof e.Scope))throw new Error("with requires a Object or Array");for(var n=0;n<this.el.children.length;n++)this.el.children[n].__scope__=this.src.value}},e.bindings.foreach={__foreach_children__:[],removeAllChildren:function(){for(;0!==this.el.children.length;)this.el.removeChild(this.el.children[0])},bind:function(){this.src.setEval(e._evalOnScope);for(var n=[],i=0;i<this.el.children.length;i++)n.push(this.el.children[i]);this.__foreach_children__=n},update:function(){if(this.removeAllChildren(),this.src.update(),!(this.src.value instanceof e.Scope))throw new Error("foreach requires a Object or Array");for(var n in this.src.value.values)for(var i=0;i<this.__foreach_children__.length;i++){var t=this.__foreach_children__[i].cloneNode(!0);t.__scope__=this.src.value.values[n],this.el.appendChild(t)}},unbind:function(){this.removeAllChildren();for(var e=0;e<this.__foreach_children__.length;e++){var n=this.__foreach_children__[e].cloneNode(!0);this.el.appendChild(n)}}},e.bindings.repeat={__foreach_children__:[],removeAllChildren:function(){for(;0!==this.el.children.length;)this.el.removeChild(this.el.children[0])},bind:function(){for(var e=[],n=0;n<this.el.children.length;n++)e.push(this.el.children[n]);this.__foreach_children__=e},update:function(){this.removeAllChildren(),this.src.update();for(var e=0;e<this.src.value;e++)for(var n=0;n<this.__foreach_children__.length;n++){var i=this.__foreach_children__[n].cloneNode(!0);this.el.appendChild(i)}},unbind:function(){this.removeAllChildren();for(var e=0;e<this.__foreach_children__.length;e++){var n=this.__foreach_children__[e].cloneNode(!0);this.el.appendChild(n)}}}}(bindings),ctx.bindings=bindings}(this);